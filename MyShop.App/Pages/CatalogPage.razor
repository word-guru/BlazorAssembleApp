@page "/catalog"
@using MyShop.Models
@using MyShop.App.Data.Interface
@using MyShop.Client
@using Blazored.Toast.Services

@inject ICatalog Catalog
@inject ICart Cart
@inject IJSRuntime JS
@inject IShopClient Client
@inject IToastService toastService

<h3>Список товаров</h3>

@if (ProductList != null)
{
    @foreach (var product in ProductList)
    {
        <div>
            <p>
                @product.Name (цена: @product.Price)
                <button name="@product.Id"
                        class="btn btn-primary btn-success"
                        @onclick="@(() => {
                                              Cart.AddingToCart(product); 
                                              toastService.ShowSuccess("Товар добавлен в корзину", "Выполнено");
                                              
                                  })"
                        type="submit">
                    Купить
                </button>
            </p>
        </div>
    }
}
else
{
    <p>Load...</p>
}

@code
{
    private void SubmitToCart(Product product)
    {
        Cart.AddingToCart(product);
        JS.InvokeVoidAsync("show_message", args: "Товар добавлен в корзину!");
    }

    private IEnumerable<Product>? ProductList = null;


    protected async override Task OnInitializedAsync()
    {
        ProductList = await Client.GetProducts();
    }

}